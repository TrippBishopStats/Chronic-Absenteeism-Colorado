---
title: "Chronic Absenteeism in Colorado School Districts"
subtitle: "School years 2016-2017 to 2022-2023"
author: "Tripp Bishop"
format: html
---

```{r setup}
#| message: false
#| echo: false
library(tidyverse)
library(janitor)
library(readxl)
library(naniar)
rm(list=ls())
# run all the preprocessing code.
source("scripts/data-prep.R")
standard_chart_colour <- "#001970"
```

## Overview

Add basic introductory text here such as stating the problem and introducing definitions. List the objectives of
the analysis.

### Definitions

* **Truancy**: Truancy is defined as an unexcused absence. The rate is calculated by dividing the reported Total Student Days Unexcused Absences by the Total Student Days Possible.
* **Habitually Truant (Student Count)**: A student is counted as habitually truant if the student has 4 excused absences in one month and/or 10 unexcused absences in one school year.
* **Chronically Absent**: A student absent 10 percent or more of the days enrolled during the school year is chronically absent. All absences are included - unexcused and excused. The rate is the percentage of students enrolled who are chronically absent.

### Objectives

* Understand how rates of chronic absenteeism change temporally and spatial from 2016 to 2023.
* Compare chronic absenteeism rates in different regions of Colorado
* Understand if COVID-19 appears to have had a significant effect on chronic absentee rates.
* Understand if school district size is correlated with chronic absentee rates.


## Data Sources

Make general statements about the data sources and state assumptions about quality of the data.

Absenteeism Data: [Colorado Department of Education](https://www.cde.state.co.us/cdereval/truancystatistics)

School District Shape Files: [Colorado Geospatial Portal](https://geodata.colorado.gov/datasets/COOIT::school-districts/about)



## Data prepartion

### Standarising file names, fields, and naming conventions



### The shape file

School districts to repair --
FREMONT RE-2 - Florence RE-2 School District
CUSTER COUNTY SCHOOL DISTRICT C-1 - Consolidated C-1 School District (Westcliffe)
JULESBURG RE-1 - Platte Valley RE-7 School District

## Data processing

### Understanding missingness



#### 2016-2017 school year

```{r check for missingness 2016}
naniar::miss_case_summary(df_2016) |> 
  filter(n_miss > 0) |> 
  inner_join(df_2016 |> 
  rowid_to_column("case"), by=c("case"))
```

#### 2017-2018 school year

```{r check for missingness 2017}
naniar::miss_case_summary(df_2017) |> 
  filter(n_miss > 0) |> 
  inner_join(df_2017 |> 
  rowid_to_column("case"), by=c("case"))
```

#### 2018-2019 school year

```{r check for missingness 2018}
naniar::miss_case_summary(df_2018) |> 
  filter(n_miss > 0) |> 
  inner_join(df_2018 |> 
  rowid_to_column("case"), by=c("case"))
```

#### 2019-2020 school year

```{r check for missingness 2019}
naniar::miss_case_summary(df_2019) |> 
  filter(n_miss > 0) |> 
  inner_join(df_2019 |> 
  rowid_to_column("case"), by=c("case"))
```

#### 2020-2021 school year

```{r check for missingness 2020}
naniar::miss_case_summary(df_2020) |> 
  filter(n_miss > 0) |> 
  inner_join(df_2020 |> 
  rowid_to_column("case"), by=c("case"))
```

#### 2021-2022 school year

```{r check for missingness 2021}
naniar::miss_case_summary(df_2021) |> 
  filter(n_miss > 0) |> 
  inner_join(df_2021 |> 
  rowid_to_column("case"), by=c("case"))
```


#### 2022-2023 school year

```{r check for missingness 2022}
naniar::miss_case_summary(df_2022) |> 
  filter(n_miss > 0) |> 
  inner_join(df_2022 |> 
  rowid_to_column("case"), by=c("case"))
```





### Examination of unvariates

There are 3 numeric fields that need to be reviewed: `chronically_absent_rate`,
`absentee_students`, and `total_students`. All of these fields should have 
positive values. The first, `chronically_absent_rate` should range between 0 and
1. In addition to these numeric fields, the school_districts need to be examined
to ensure that all datasets include the same 178 school districts. Additionally,
each dataset should contain 178 observations for the same school year.

#### Verify school districts

Each dataset has 178 school district records. They should all be unique and 
identical between school years. Since `district_code` can be converted to an
integer, we can create a function that does this and then sums the resulting
integers for each dataset.

```{r}
districts_2016 <- compute_district_total(df_2016)
districts_2017 <- compute_district_total(df_2017)
districts_2018 <- compute_district_total(df_2018)
districts_2019 <- compute_district_total(df_2019)
districts_2020 <- compute_district_total(df_2020)
districts_2021 <- compute_district_total(df_2021)
districts_2022 <- compute_district_total(df_2022)
```

Every dataset has the same result, `r districts_2016`, so the 178 districts are 
the same across all 7 datasets.

#### Verify school year information

Each dataset should have a single value in the `school_year` field. If this is
not the case, determine what the discrepancy is and make the correction.

```{r}
school_year_2016_count <- school_year_count(df_2016)
school_year_2017_count <- school_year_count(df_2017)
school_year_2018_count <- school_year_count(df_2018)
school_year_2019_count <- school_year_count(df_2019)
school_year_2020_count <- school_year_count(df_2020)
school_year_2021_count <- school_year_count(df_2021)
school_year_2022_count <- school_year_count(df_2022)
```

The datasets all contain a single value for the `school_year`.

#### 2016-2017 school year data

First, confirm that `chronically_absent_rate` contains valid values and their
distribution with a histogram.

```{r}
df_2016 |>
  filter(!is.na(chronically_absent_rate)) |> 
  ggplot(aes(x=chronically_absent_rate)) +
  geom_histogram(binwidth = 0.05, colour="white", fill=standard_chart_colour) +
  labs(
    title = "Distribution of district chronic absenteeism",
    subtitle = "School year 2016-2017",
    x="Chronically absent rate",
    y="Count"
  )
```
The data range is valid, but the distribution is suspect. A significant number
of the districts report 0 chronically absent students in 2016-2017. This seems
unlikely. Is 0 being used to indicate "no data" or do these districts actually 
have no students that are chronically absent? This question does not appear to
be answered on the [Colorado Department of Education website](https://www.cde.state.co.us/dropoutprevention/attendance).


```{r}
summary(df_2016$total_students)
```

```{r}
df_2016 |>
  filter(!is.na(total_students)) |> 
  ggplot(aes(x=total_students)) +
  geom_histogram(colour="white", fill=standard_chart_colour) +
  labs(
    title = "Distribution of district student enrollment",
    subtitle = "School year 2016-2017",
    x="Student enrollment",
    y="Count"
  )
```

```{r}
summary(df_2016$absentee_students)
```


```{r}
df_2016 |>
  filter(!is.na(absentee_students)) |> 
  ggplot(aes(x=absentee_students)) +
  geom_histogram(colour="white", fill=standard_chart_colour) +
  labs(
    title = "Distribution of district chronic absenteeism",
    subtitle = "School year 2016-2017",
    x="Absentee students",
    y="Count"
  )
```

#### 2017-2018 school year data

First, confirm that `chronically_absent_rate` contains valid values and their
distribution with a histogram.

```{r}
df_2017 |>
  filter(!is.na(chronically_absent_rate)) |> 
  ggplot(aes(x=chronically_absent_rate)) +
  geom_histogram(binwidth = 0.05, colour="white", fill=standard_chart_colour) +
  labs(
    title = "Distribution of district chronic absenteeism",
    subtitle = "School year 2017-2018",
    x="Chronically absent rate",
    y="Count"
  )
```




#### 2018-2019 school year data

First, confirm that `chronically_absent_rate` contains valid values and their
distribution with a histogram.

```{r}
df_2018 |>
  filter(!is.na(chronically_absent_rate)) |> 
  ggplot(aes(x=chronically_absent_rate)) +
  geom_histogram(binwidth = 0.05, colour="white", fill=standard_chart_colour) +
  labs(
    title = "Distribution of district chronic absenteeism",
    subtitle = "School year 2018-2019",
    x="Chronically absent rate",
    y="Count"
  )
```





#### 2019-2020 school year data

First, confirm that `chronically_absent_rate` contains valid values and their
distribution with a histogram.

```{r}
df_2019 |>
  filter(!is.na(chronically_absent_rate)) |> 
  ggplot(aes(x=chronically_absent_rate)) +
  geom_histogram(binwidth = 0.05, colour="white", fill=standard_chart_colour) +
  labs(
    title = "Distribution of district chronic absenteeism",
    subtitle = "School year 2019-2020",
    x="Chronically absent rate",
    y="Count"
  )
```


#### 2020-2021 school year data

First, confirm that `chronically_absent_rate` contains valid values and their
distribution with a histogram.

```{r}
df_2020 |>
  filter(!is.na(chronically_absent_rate)) |> 
  ggplot(aes(x=chronically_absent_rate)) +
  geom_histogram(binwidth = 0.05, colour="white", fill=standard_chart_colour) +
  labs(
    title = "Distribution of district chronic absenteeism",
    subtitle = "School year 2020-2021",
    x="Chronically absent rate",
    y="Count"
  )
```


#### 2021-2022 school year data

First, confirm that `chronically_absent_rate` contains valid values and their
distribution with a histogram.

```{r}
df_2021 |>
  filter(!is.na(chronically_absent_rate)) |> 
  ggplot(aes(x=chronically_absent_rate)) +
  geom_histogram(binwidth = 0.05, colour="white", fill=standard_chart_colour) +
  labs(
    title = "Distribution of district chronic absenteeism",
    subtitle = "School year 2021-2022",
    x="Chronically absent rate",
    y="Count"
  )
```



#### 2022-2023 school year data

First, confirm that `chronically_absent_rate` contains valid values and their
distribution with a histogram.

```{r}
df_2022 |>
  filter(!is.na(chronically_absent_rate)) |> 
  ggplot(aes(x=chronically_absent_rate)) +
  geom_histogram(binwidth = 0.05, colour="white", fill=standard_chart_colour) +
  labs(
    title = "Distribution of district chronic absenteeism",
    subtitle = "School year 2022-2023",
    x="Chronically absent rate",
    y="Count"
  )
```


## Analysis


## Key findings




